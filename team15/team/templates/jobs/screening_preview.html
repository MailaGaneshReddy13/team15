{% extends 'base.html' %}

{% block title %}Screening Result - {{ job.title }}{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-9">
        <div class="card p-4 shadow-lg border-0">
            <h2 class="text-center mb-4">Resume Screening Preview</h2>
            <div class="alert alert-info border-0 shadow-sm text-center">
                <i class="bi bi-info-circle-fill me-2"></i> This is a preview of your match score. Review the feedback
                below before applying.
            </div>

            <div class="text-center mb-5 mt-4">
                <div
                    class="display-1 fw-bold {% if resume.match_score >= 80 %}text-success{% elif resume.match_score >= 50 %}text-warning{% else %}text-danger{% endif %}">
                    {{ resume.match_score|floatformat:0 }}%
                </div>
                <h5 class="text-secondary">Job Match Score</h5>

                <div class="progress mt-3 mx-auto" style="height: 25px; width: 80%; border-radius: 12px;">
                    <div class="progress-bar progress-bar-striped progress-bar-animated {% if resume.match_score >= 80 %}bg-success{% elif resume.match_score >= 50 %}bg-warning{% else %}bg-danger{% endif %}"
                        role="progressbar" style="width: {{ resume.match_score|floatformat:0 }}%;"
                        aria-valuenow="{{ resume.match_score|floatformat:0 }}" aria-valuemin="0" aria-valuemax="100">
                    </div>
                </div>
            </div>

            <div class="row justify-content-center mb-4">
                <div class="col-auto">
                    <span class="badge bg-secondary opacity-75">Data Calculated: {{ last_updated }}</span>
                </div>
            </div>

            <div class="row g-4 mb-4">
                <div class="col-md-6">
                    <div class="card bg-light border-0 h-100 p-3">
                        <h6 class="text-success fw-bold mb-3"><i class="bi bi-check-circle-fill me-2"></i>Skills Matched
                        </h6>
                        {% if matched_skills %}
                        <div class="d-flex flex-wrap gap-2">
                            {% for s in matched_skills %}
                            <span class="badge bg-success bg-opacity-10 text-success">
                                {{ s }}
                            </span>
                            {% endfor %}
                        </div>
                        {% else %}
                        <p class="text-muted small">No direct skill matches found.</p>
                        {% endif %}
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card bg-light border-0 h-100 p-3">
                        <h6 class="text-danger fw-bold mb-3"><i class="bi bi-exclamation-triangle-fill me-2"></i>Missing
                            Skills</h6>
                        {% if missing_skills %}
                        <div class="d-flex flex-wrap gap-2">
                            {% for s in missing_skills %}
                            <span class="badge bg-danger bg-opacity-10 text-danger">
                                {{ s }}
                            </span>
                            {% endfor %}
                        </div>
                        {% else %}
                        <p class="text-muted small">Excellent! No major skills missing.</p>
                        {% endif %}
                    </div>
                </div>
            </div>

            <div class="mt-4">
                <h5 class="fw-bold"><i class="bi bi-chat-left-dots-fill me-2 text-primary"></i>AI Feedback</h5>
                <p class="bg-light p-3 rounded shadow-sm">
                    {{ resume.ai_feedback }}
                </p>

                <h5 class="fw-bold mt-4"><i class="bi bi-lightbulb-fill me-2 text-warning"></i>Improvement Suggestions
                </h5>
                <p class="bg-light p-3 rounded border-start border-4 border-info shadow-sm">
                    {{ resume.improvement_suggestions }}
                </p>
            </div>

            {% if recommended_courses %}
            <hr class="my-5">
            <div class="mt-4">
                <h3 class="mb-4 text-primary"><i class="bi bi-lightning-charge-fill me-2"></i>Recommended Upskilling
                </h3>
                <p class="lead mb-4">Based on your missing skills, we recommend the following courses to boost your
                    profile:</p>

                <div class="row g-4">
                    {% for course in recommended_courses %}
                    <div class="col-md-4">
                        <div class="card h-100 border-0 shadow-sm">
                            {% if course.thumbnail %}
                            <img src="{{ course.thumbnail.url }}" class="card-img-top" alt="{{ course.title }}"
                                style="height: 150px; object-fit: cover;">
                            {% else %}
                            <div class="bg-primary d-flex align-items-center justify-content-center"
                                style="height: 150px;">
                                <i class="bi bi-book-half text-white" style="font-size: 3rem;"></i>
                            </div>
                            {% endif %}
                            <div class="card-body">
                                <h6 class="card-title fw-bold">{{ course.title }}</h6>
                                <p class="small text-muted mb-2">{{ course.category|title }}</p>
                                <a href="{% url 'course_detail' course.id %}"
                                    class="btn btn-outline-primary btn-sm w-100 stretched-link">Start Learning</a>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <hr class="my-5">

            <div class="text-center">
                {% if resume.match_score >= 80 %}
                <div class="alert alert-success border-0 shadow-sm mb-4">
                    <i class="bi bi-check-lg me-2"></i> Great! You meet the 80% match requirement. You can now submit
                    your application.
                </div>
                <form action="{% url 'confirm_apply' resume.id job.id %}" method="post">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-success btn-lg px-5 shadow">
                        <i class="bi bi-send-fill me-2"></i> Submit Application
                    </button>
                </form>
                {% else %}
                <div class="alert alert-warning border-0 shadow-sm mb-4">
                    <i class="bi bi-lock-fill me-2"></i> A match score of <strong>80% or higher</strong> is required to
                    apply. Please improve your resume and try again!
                </div>
                <button class="btn btn-secondary btn-lg px-5 shadow" disabled>
                    <i class="bi bi-send-slash-fill me-2"></i> Application Restricted
                </button>
                {% endif %}
                <div class="mt-3">
                    <a href="{% url 'job_detail' job.id %}" class="btn btn-link text-decoration-none">
                        <i class="bi bi-arrow-left me-1"></i> Back to Job Details
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}